{% extends "base.html" %}
{% block content %}
<section class="list-card">
  <h2>Top 50 Off-Flavors</h2>
  <p class="small">Select a flavor to view causes, likely style appearance, and avoidance tips.</p>

  <div class="library-tools">
    <label class="tool-label" for="flavor-search">Search by keyword</label>
    <input id="flavor-search" class="tool-input" type="search" placeholder="Try: skunky, paper, banana, sulfur..." />

    <label class="tool-label" for="family-filter">Filter by family</label>
    <select id="family-filter" class="tool-select">
      <option value="all">All Families</option>
      <option value="sulfur">Sulfur</option>
      <option value="oxidation">Oxidation</option>
      <option value="ester">Ester</option>
    </select>

    <p id="results-count" class="small"></p>
  </div>

  <p><a class="quiz-link" href="{{ url_for('flashcards') }}">Start 50-card learning quiz</a></p>

  <ul id="flavor-list" class="flavor-list">
    {% for flavor in flavors %}
      <li class="flavor-item" data-family="{{ flavor.family }}" data-search="{{ flavor.search_text }}">
        <a href="{{ url_for('flavor_detail', slug=flavor.slug) }}">
          <span class="name">{{ flavor.name }}</span>
          <span class="nick">{{ flavor.nickname }} Â· {{ flavor.family|title }}</span>
        </a>
      </li>
    {% endfor %}
  </ul>

  <div class="export-tools">
    <h3>Export & Share Tools</h3>
    <p class="small">Download study sheets or troubleshooting guides as PDF.</p>
    <div class="export-links">
      <a href="{{ url_for('export_study_sheet_pdf') }}">Study Sheet (PDF)</a>
      <a href="{{ url_for('export_troubleshooting_pdf') }}">Troubleshooting Guide (PDF)</a>
    </div>
  </div>
</section>

<script>
  (() => {
    const searchInput = document.getElementById("flavor-search");
    const familyFilter = document.getElementById("family-filter");
    const resultCount = document.getElementById("results-count");
    const items = Array.from(document.querySelectorAll(".flavor-item"));

    const updateCount = (visible) => {
      resultCount.textContent = `Showing ${visible} of ${items.length} flavors`;
    };

    const applyFilters = () => {
      const query = searchInput.value.trim().toLowerCase();
      const family = familyFilter.value;
      let visible = 0;

      items.forEach((item) => {
        const matchesFamily = family === "all" || item.dataset.family === family;
        const matchesQuery = query.length === 0 || item.dataset.search.includes(query);
        const show = matchesFamily && matchesQuery;
        item.classList.toggle("is-hidden", !show);
        if (show) visible += 1;
      });

      updateCount(visible);
    };

    searchInput.addEventListener("input", applyFilters);
    familyFilter.addEventListener("change", applyFilters);
    updateCount(items.length);
  })();
</script>
{% endblock %}
